{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gifts</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="{% static 'css/inter.css' %}">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,system-ui}
body{background:#0b0f14;color:#fff;display:flex;justify-content:center}

.app{width:100%;max-width:430px;height:100vh;display:flex;flex-direction:column}

/* HEADER */
.header{
  padding:14px;
  background:linear-gradient(135deg,#021d0a,#009624);
  border-radius:0 0 18px 18px;
  box-shadow:0 6px 20px rgba(0,200,83,.25)
}
.header h2{text-align:center;margin-bottom:8px}
.details p{font-size:13px;color:#ccc}
.status-row{margin-top:10px}
.progress{height:24px;background:#222;border-radius:20px;overflow:hidden}
.progress-bar{height:100%;background:#00c853;width:0%;transition:.4s}

.invite-btn{
  margin-top:12px;
  padding:10px 16px;
  border-radius:999px;
  background:#1db954;
  border:none;
  color:#02120a;
  font-weight:700;
  width:100%;
  cursor:pointer
}

/* GRID */
.grid{flex:1;padding:10px;display:grid;grid-template-columns:1fr 1fr;gap:10px;overflow-y:auto}
.card{background:#000;border-radius:12px;overflow:hidden;position:relative}
.thumb{height:120px;background:#000;display:flex;align-items:center;justify-content:center}
.play{width:40px;height:40px;border-radius:50%;border:2px solid white;display:flex;align-items:center;justify-content:center}
.play:before{content:'▶';margin-left:3px}
.desc{padding:8px;font-size:13px;color:#ccc}

/* NAV */
.nav{display:flex;justify-content:space-around;padding:12px 0;background:#0e141b;border-top:1px solid #1c2633}
.nav a{color:#888;text-decoration:none}
.nav .active{color:#00c853}
</style>
</head>

<body>
<div class="app">

<div class="header">
  <h2>Gifts</h2>

  <div class="details">
    <p id="giftTitle">Loading…</p>
    <p id="giftDescription"></p>
    <p id="giftTime"></p>
    <p id="giftInvites"></p>
  </div>

  <div class="status-row">
    <div class="progress"><div class="progress-bar" id="progressFill"></div></div>
    <button id="inviteBtn" class="invite-btn">Invite</button>
  </div>
</div>

<div class="grid" id="videosGrid">
  {% for v in extra_videos %}
  <article class="card"
    data-id="{{ v.id }}"
    data-url="{{ v.url }}"
    data-title="{{ v.title|escapejs }}"
    data-reward="{{ v.reward }}">
    
    <div class="thumb" style="background-image:url('{% if v.thumbnail %}{{ v.thumbnail.url }}{% else %}{% static 'img/placeholder.jpg' %}{% endif %}');background-size:cover">
      <div class="play"></div>
    </div>
    <div class="desc">{{ v.title }}</div>
  </article>
  {% endfor %}
</div>

<div class="nav">
  <a href="{% url 'dashboard:home' %}">Home</a>
  <a href="{% url 'dashboard:tasks' %}">Tasks</a>
  <a class="active">Gifts</a>
  <a href="{% url 'dashboard:account' %}">Account</a>
</div>

</div>

<script src="{% static 'js/gifts_player.js' %}"></script>

<script>
fetch("{% url 'dashboard:gifts_data_api' %}")
.then(r=>r.json()).then(data=>{
  if(!data.gift)return;

  const g=data.gift;
  document.getElementById('giftTitle').innerText=g.title;
  document.getElementById('giftDescription').innerText=g.description;
  document.getElementById('giftInvites').innerText=`Invites: ${g.current_invites}/${g.required_invites}`;

  const fill=document.getElementById('progressFill');
  fill.style.width=Math.min(100,(g.current_invites/g.required_invites)*100)+'%';

  const end=new Date(g.expires_at);
  setInterval(()=>{
    const d=end-new Date();
    if(d<=0)return document.getElementById('giftTime').innerText="Expired";
    const m=Math.floor(d/60000),s=Math.floor((d%60000)/1000);
    document.getElementById('giftTime').innerText=`Expires in ${m}m ${s}s`;
  },1000);
});
</script>

<script>
const inviteBtn=document.getElementById("inviteBtn");
const referralLink="{{ referral_link|escapejs }}";

inviteBtn.onclick=async()=>{
  const text="Earn money with me on Renocorp!";
  try{
    if(navigator.share)await navigator.share({title:"Renocorp",text,url:referralLink});
    else throw "";
  }catch{
    await navigator.clipboard.writeText(referralLink);
    alert("Invite link copied");
  }
}
</script>
</body>
  </html>
